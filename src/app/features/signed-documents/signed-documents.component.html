<div class="dashboard-layout">
  <!-- Sidebar -->
  <app-sidebar #sidebar></app-sidebar>

  <!-- Main Content -->
  <div class="main-content" [class.sidebar-expanded]="sidebar.isSidebarExpanded">
    <header class="main-header">
      <div class="header-left">
        <button class="menu-toggle" (click)="sidebar.toggleSidebar()">
          <i class="icon-menu"></i>
        </button>
        <h1 class="page-title">Documentos Firmados</h1>
      </div>

      <div class="header-right">
      </div>
    </header>

    <main class="main-body">
      <div class="signed-documents-container">
        <!-- Filters Section -->
        <div class="filters-section">
          <div class="filters-grid">
            <div class="filter-group">
              <label for="search">Buscar</label>
              <input
                id="search"
                type="text"
                formControlName="search"
                class="form-control"
                (input)="applyFilters()"
                placeholder="Buscar por archivo, firmante, DNI, motivo, cargo...">
            </div>
            
            <div class="filter-group">
              <label for="dateFrom">Creado desde</label>
              <input
                type="date"
                id="dateFrom"
                formControlName="dateFrom"
                class="form-control"
                (change)="applyFilters()"
                title="Documentos creados desde esta fecha">
            </div>

            <div class="filter-group">
              <label for="dateTo">Creado hasta</label>
              <input
                type="date"
                id="dateTo"
                formControlName="dateTo"
                class="form-control"
                (change)="applyFilters()"
                title="Documentos creados hasta esta fecha">
            </div>

            <div class="filter-actions">
              <button class="btn btn-secondary" (click)="clearFilters()">
                Limpiar filtros
              </button>
            </div>
          </div>
        </div>

        <!-- Table Section -->
        <div class="table-section">
          <div class="table-header">
            <div class="table-info">
              <span>{{ totalElements }} documentos encontrados</span>
            </div>
            
            <div class="table-actions">
              <div class="page-size-selector">
                <label for="pageSize">Mostrar:</label>
                <select 
                  id="pageSize"
                  [(ngModel)]="pageSize"
                  (change)="onPageSizeChange(pageSize)"
                  class="form-control">
                  <option value="10">10</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div *ngIf="isLoading" class="loading-container">
              <div class="loading-spinner">
                <div class="loading"></div>
                <span>Cargando documentos...</span>
              </div>
            </div>

            <table *ngIf="!isLoading" class="table">
              <thead>
                <tr>
                  <th class="sortable" (click)="onSort('originalFilename')">
                    Documento
                    <span class="sort-icon">{{ getSortIcon('originalFilename') }}</span>
                  </th>
                  <th class="sortable" (click)="onSort('firmanteNombre')">
                    Firmante
                    <span class="sort-icon">{{ getSortIcon('firmanteNombre') }}</span>
                  </th>
                  <th class="sortable" (click)="onSort('firmanteDni')">
                    DNI
                    <span class="sort-icon">{{ getSortIcon('firmanteDni') }}</span>
                  </th>
                  <th class="sortable" (click)="onSort('signedAt')">
                    Fecha de Firma
                    <span class="sort-icon">{{ getSortIcon('signedAt') }}</span>
                  </th>
                  <th class="sortable" (click)="onSort('createdAt')">
                    Fecha de Creación
                    <span class="sort-icon">{{ getSortIcon('createdAt') }}</span>
                  </th>
                  <th class="sortable" (click)="onSort('status')">
                    Estado
                    <span class="sort-icon">{{ getSortIcon('status') }}</span>
                  </th>
                  <th class="sortable" (click)="onSort('signatureType')">
                    Tipo
                    <span class="sort-icon">{{ getSortIcon('signatureType') }}</span>
                  </th>
                  <th class="actions-col">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="isLoading" class="loading-row">
                  <td colspan="8" class="text-center">
                    <div class="loading-spinner">
                      <div class="loading"></div>
                      <span>Cargando documentos...</span>
                    </div>
                  </td>
                </tr>
                
                <tr *ngIf="!isLoading && filteredDocuments.length === 0" class="empty-row">
                  <td colspan="8" class="text-center">
                    <div class="empty-state">
                      <i class="icon-empty"></i>
                      <h3>No se encontraron documentos</h3>
                      <p>No hay documentos firmados que coincidan con los filtros aplicados.</p>
                    </div>
                  </td>
                </tr>
                
                <tr *ngFor="let document of filteredDocuments" class="document-row">
                  <td>
                    <div class="document-info">
                      <div class="document-name">{{ document.originalFilename || 'N/A' }}</div>
                      <div class="document-signed" *ngIf="document.signedFilename">{{ document.signedFilename }}</div>
                    </div>
                  </td>
                  <td>
                    <div class="firmante-info">
                      <div class="firmante-name">{{ document.firmanteNombre || 'N/A' }}</div>
                      <div class="firmante-cargo" *ngIf="document.cargoFirmante">{{ document.cargoFirmante }}</div>
                    </div>
                  </td>
                  <td>
                    <div class="dni-info">{{ document.firmanteDni || 'N/A' }}</div>
                  </td>
                  <td>
                    <div class="date">{{ document.signedAt ? formatDate(document.signedAt) : 'N/A' }}</div>
                  </td>
                  <td>
                    <div class="date">{{ formatDate(document.createdAt) }}</div>
                  </td>
                  <td>
                    <span class="badge" [class]="getStatusBadgeClass(document.status)">
                      {{ getStatusDisplayName(document.status) }}
                    </span>
                  </td>
                  <td>
                    <div class="signature-type">{{ document.signatureType || 'N/A' }}</div>
                  </td>
                  <td>
                    <div class="actions">
                      <button 
                        class="action-btn"
                        (click)="onViewDocument(document)"
                        title="Ver detalles">
                        <i class="icon-eye"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="pagination-container" *ngIf="totalPages > 1">
            <div class="pagination-info">
              Mostrando {{ currentPage * pageSize + 1 }} a 
              {{ getMaxItemsShown() }} de 
              {{ totalElements }} registros
            </div>
            
            <div class="pagination">
              <button 
                class="pagination-btn"
                [disabled]="currentPage === 0"
                (click)="onPageChange(currentPage - 1)">
                <i class="icon-chevron-left"></i>
              </button>
              
              <button 
                *ngFor="let page of getPages()"
                class="pagination-btn"
                [class.active]="page === currentPage"
                (click)="onPageChange(page)">
                {{ page + 1 }}
              </button>
              
              <button 
                class="pagination-btn"
                [disabled]="currentPage === totalPages - 1"
                (click)="onPageChange(currentPage + 1)">
                <i class="icon-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- View Document Modal -->
<div class="modal-overlay" *ngIf="showViewModal" (click)="closeViewModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Detalles del Documento</h2>
      <button class="modal-close" (click)="closeViewModal()">
        <i class="icon-close"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="document-details-grid" *ngIf="selectedDocument">
        <div class="detail-section">
          <h3>Información del Documento</h3>
          <div class="detail-row">
            <label>Nombre original:</label>
            <span>{{ selectedDocument.originalFilename || 'N/A' }}</span>
          </div>
          <div class="detail-row" *ngIf="selectedDocument.signedFilename">
            <label>Nombre firmado:</label>
            <span>{{ selectedDocument.signedFilename }}</span>
          </div>
          <div class="detail-row">
            <label>UUID del archivo:</label>
            <span class="file-path">{{ selectedDocument.fileUuid || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <label>URL local:</label>
            <span>{{ selectedDocument.localUrl || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <label>Estado:</label>
            <span class="badge" [class]="getStatusBadgeClass(selectedDocument.status)">
              {{ getStatusDisplayName(selectedDocument.status) }}
            </span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Información del Firmante</h3>
          <div class="detail-row">
            <label>Firmante:</label>
            <span>{{ selectedDocument.firmanteNombre || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <label>ID Usuario:</label>
            <span>{{ selectedDocument.firmanteUserId || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <label>DNI:</label>
            <span>{{ selectedDocument.firmanteDni || 'N/A' }}</span>
          </div>
          <div class="detail-row" *ngIf="selectedDocument.cargoFirmante">
            <label>Cargo:</label>
            <span>{{ selectedDocument.cargoFirmante }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Información de Firma</h3>
          <div class="detail-row">
            <label>Fecha de firma:</label>
            <span>{{ selectedDocument.signedAt ? formatDate(selectedDocument.signedAt) : 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <label>Tipo de firma:</label>
            <span class="badge badge-success">
              {{ selectedDocument.signatureType || 'N/A' }}
            </span>
          </div>
          <div class="detail-row" *ngIf="selectedDocument.idDocumentoProcesoFirma">
            <label>ID Documento Proceso:</label>
            <span>{{ selectedDocument.idDocumentoProcesoFirma }}</span>
          </div>
          <div class="detail-row" *ngIf="selectedDocument.idGrupoProcesoFirma">
            <label>ID Grupo Proceso:</label>
            <span>{{ selectedDocument.idGrupoProcesoFirma }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Información del Sistema</h3>
          <div class="detail-row">
            <label>Fecha de registro:</label>
            <span>{{ formatDate(selectedDocument.createdAt) }}</span>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeViewModal()">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>