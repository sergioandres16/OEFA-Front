<app-layout>
<div class="users-container">
  <div class="users-header">
    <div class="header-left">
      <h1>Gesti√≥n de Firmantes</h1>
      <p>Administra los firmantes del sistema de firmas digitales</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateModal()">
        <i class="icon-user-add"></i>
        Crear Firmante
      </button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="filter-group">
        <label for="search">Buscar</label>
        <input
          type="text"
          id="search"
          class="form-control"
          [(ngModel)]="filters.search"
          (input)="applyFilters()"
          placeholder="Nombre, email, DNI o cargo...">
      </div>
      
      <div class="filter-group">
        <label for="status">Estado</label>
        <select 
          id="status" 
          class="form-control"
          [(ngModel)]="filters.status"
          (change)="applyFilters()">
          <option value="">Todos los estados</option>
          <option *ngFor="let status of statusOptions" [value]="status.value">
            {{ status.label }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="dateFrom">Desde</label>
        <input
          type="date"
          id="dateFrom"
          class="form-control"
          [(ngModel)]="filters.dateFrom"
          (change)="applyFilters()">
      </div>
      
      <div class="filter-group">
        <label for="dateTo">Hasta</label>
        <input
          type="date"
          id="dateTo"
          class="form-control"
          [(ngModel)]="filters.dateTo"
          (change)="applyFilters()">
      </div>
      
      <div class="filter-actions">
        <button class="btn btn-secondary" (click)="clearFilters()">
          Limpiar filtros
        </button>
      </div>
    </div>
  </div>

  <!-- Table Section -->
  <div class="table-section">
    <div class="table-header">
      <div class="table-info">
        <span>{{ totalElements }} firmantes encontrados</span>
      </div>
      
      <div class="table-actions">
        <div class="page-size-selector">
          <label for="pageSize">Mostrar:</label>
          <select 
            id="pageSize"
            [(ngModel)]="pageSize"
            (change)="onPageSizeChange(pageSize)"
            class="form-control">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
        </div>
      </div>
    </div>

    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th class="sortable" (click)="onSort('nombre')">
              Usuario
              <span class="sort-icon">{{ getSortIcon('nombre') }}</span>
            </th>
            <th class="sortable" (click)="onSort('email')">
              Email
              <span class="sort-icon">{{ getSortIcon('email') }}</span>
            </th>
            <th class="sortable" (click)="onSort('dni')">
              DNI
              <span class="sort-icon">{{ getSortIcon('dni') }}</span>
            </th>
            <th class="sortable" (click)="onSort('role')">
              Rol
              <span class="sort-icon">{{ getSortIcon('role') }}</span>
            </th>
            <th class="sortable" (click)="onSort('status')">
              Estado
              <span class="sort-icon">{{ getSortIcon('status') }}</span>
            </th>
            <th class="sortable" (click)="onSort('createdAt')">
              Fecha de Registro
              <span class="sort-icon">{{ getSortIcon('createdAt') }}</span>
            </th>
            <th class="actions-col">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="isLoading" class="loading-row">
            <td colspan="7" class="text-center">
              <div class="loading-spinner">
                <div class="loading"></div>
                <span>Cargando usuarios...</span>
              </div>
            </td>
          </tr>
          
          <tr *ngIf="!isLoading && filteredUsers.length === 0" class="empty-row">
            <td colspan="7" class="text-center">
              <div class="empty-state">
                <i class="icon-empty"></i>
                <h3>No se encontraron usuarios</h3>
                <p>Intenta ajustar los filtros o crea un nuevo usuario</p>
              </div>
            </td>
          </tr>
          
          <tr *ngFor="let user of filteredUsers" class="user-row">
            <td>
              <div class="user-info">
                <div class="user-avatar">
                  <span>{{ user.nombre.charAt(0) }}{{ user.apellido.charAt(0) }}</span>
                </div>
                <div class="user-details">
                  <div class="user-name">{{ user.nombre }} {{ user.apellido }}</div>
                  <div class="user-cargo">{{ user.cargo }}</div>
                </div>
              </div>
            </td>
            <td>
              <div class="email-info">{{ user.email }}</div>
            </td>
            <td>
              <div class="dni-info">{{ user.dni }}</div>
            </td>
            <td>
              <span class="role-badge" [class]="'role-' + user.role">
                {{ getRoleDisplayName(user.role) }}
              </span>
            </td>
            <td>
              <span class="badge" [class]="getStatusBadgeClass(user.status)">
                {{ getStatusDisplayName(user.status) }}
              </span>
            </td>
            <td>
              <div class="date">{{ formatDateTime(user.createdAt!) }}</div>
            </td>
            <td>
              <div class="actions">
                <button 
                  class="action-btn"
                  (click)="onViewUser(user)"
                  title="Ver detalles">
                  <i class="icon-eye"></i>
                </button>
                
                <button 
                  class="action-btn"
                  (click)="onEditUser(user)"
                  title="Editar">
                  <i class="icon-edit"></i>
                </button>
                
                <button 
                  *ngIf="user.status === 'PENDING'"
                  class="action-btn"
                  (click)="onResendCredentials(user)"
                  title="Reenviar credenciales">
                  <i class="icon-mail"></i>
                </button>
                
                <button 
                  class="action-btn"
                  (click)="onToggleStatus(user)"
                  [title]="user.status === 'ACTIVE' ? 'Desactivar' : 'Activar'">
                  <i class="icon-toggle"></i>
                </button>
                
                <button 
                  class="action-btn delete"
                  (click)="onDeleteUser(user)"
                  title="Eliminar">
                  <i class="icon-delete"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination-info">
        Mostrando {{ currentPage * pageSize + 1 }} a 
        {{ getMaxItemsShown() }} de 
        {{ totalElements }} registros
      </div>
      
      <div class="pagination">
        <button 
          class="pagination-btn"
          [disabled]="currentPage === 0"
          (click)="onPageChange(currentPage - 1)">
          <i class="icon-chevron-left"></i>
        </button>
        
        <button 
          *ngFor="let page of getPages()"
          class="pagination-btn"
          [class.active]="page === currentPage"
          (click)="onPageChange(page)">
          {{ page + 1 }}
        </button>
        
        <button 
          class="pagination-btn"
          [disabled]="currentPage === totalPages - 1"
          (click)="onPageChange(currentPage + 1)">
          <i class="icon-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Create User Modal -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Crear Nuevo Firmante</h2>
      <button class="modal-close" (click)="closeCreateModal()">
        <i class="icon-close"></i>
      </button>
    </div>
    
    <form [formGroup]="createUserForm" (ngSubmit)="onCreateUser()" class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label for="nombre" class="form-label">Nombre *</label>
          <input
            id="nombre"
            type="text"
            formControlName="nombre"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('nombre')"
            placeholder="Ingresa el nombre">
          <span *ngIf="getFieldError('nombre')" class="form-error">
            {{ getFieldError('nombre') }}
          </span>
        </div>

        <div class="form-group">
          <label for="apellido" class="form-label">Apellido *</label>
          <input
            id="apellido"
            type="text"
            formControlName="apellido"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('apellido')"
            placeholder="Ingresa el apellido">
          <span *ngIf="getFieldError('apellido')" class="form-error">
            {{ getFieldError('apellido') }}
          </span>
        </div>

        <div class="form-group">
          <label for="email" class="form-label">Email *</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('email')"
            placeholder="usuario@empresa.com">
          <span *ngIf="getFieldError('email')" class="form-error">
            {{ getFieldError('email') }}
          </span>
        </div>

        <div class="form-group">
          <label for="dni" class="form-label">DNI *</label>
          <input
            id="dni"
            type="text"
            formControlName="dni"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('dni')"
            placeholder="12345678"
            maxlength="8">
          <span *ngIf="getFieldError('dni')" class="form-error">
            {{ getFieldError('dni') }}
          </span>
        </div>

        <div class="form-group">
          <label for="cargo" class="form-label">Cargo *</label>
          <input
            id="cargo"
            type="text"
            formControlName="cargo"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('cargo')"
            placeholder="Especialista en Medio Ambiente">
          <span *ngIf="getFieldError('cargo')" class="form-error">
            {{ getFieldError('cargo') }}
          </span>
        </div>

        <div class="form-group">
          <label for="role" class="form-label">Rol *</label>
          <select
            id="role"
            formControlName="role"
            class="form-control">
            <option value="ROLE_FIRMANTE">Firmante</option>
            <option value="ROLE_ADMIN">Administrador</option>
          </select>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-ghost" (click)="closeCreateModal()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="createUserForm.invalid">
          Crear Firmante
        </button>
      </div>
    </form>
  </div>
</div>
</app-layout>